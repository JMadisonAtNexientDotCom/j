<!DOCTYPE html>
<html>
    <head>
        <!-- for now, the only way that works for me. -->
				
			  
				<script src="../jsLib/requirejs_code/require.js"></script>
    <script src="../jsLib/requirejs_code/config/nts_config.js"></script>
				<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
				
    </head>
    <body>

    <div data-ng-app="myApp" data-ng-controller="myCtrl" data-ng-init="VI();" >
		    <div id="controls_div">
        <button data-ng-click="doIt();">{{button_label}}</button>
        <input ng-model="num_levs_deep" 
        type="number" min="2"max="6"
        data-ng-click="re_init();">
      </div>
      <div id="canvas_div">
        <!-- put canvas under buttons so buttons are easier to find. -->
        <!-- 60x40 good for small icon. -->
        <canvas id="myCanvas" width="600" height="400" style="border:0px solid #d3d3d3;">
        Your browser does not support the HTML5 canvas tag.</canvas>
      </div>
		</div>
			 
				
				<script>
				var app = angular.module('myApp', []);
				app.controller('myCtrl', function($scope, $http) {

    //variable initialization:
    $scope.VI = function(){
      $scope.msg_for_user = "Insert Token:";
      $scope.num_levs_deep = 3;
      $scope.button_label  = "START!";
      init_require_js_stuff();
    };

    $scope.doIt = function(){
      console.log("pressed");
      console.log("num levs deep==" + $scope.num_levs_deep);
      rjs_app.num_levels_deep = $scope.num_levs_deep;
      $scope.loaderToggle();
      
      if(rjs_app.getIsPaused() ){
        $scope.button_label = "RESTART!";
      }else{
        $scope.button_label = "STOP!";
      }//
    };//

    $scope.re_init = function(){
      console.log("re initializing");
      rjs_app.num_levels_deep = $scope.num_levs_deep;
      
      //Pause+Resume will force re-init:
      rjs_app.pause();
      rjs_app.resume();
    };//
					
				//Require JS code section:
				//RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR//
    var rjs_app = null;
    var has_rjs_app = false;
    var init_require_js_stuff = function(){
      var myCallback = function(arg_app){
       console.log("called back");
       arg_app.num_levels_deep = $scope.num_levs_deep;
       console.log("num_levs_deep==" + $scope.num_levs_deep);
       console.log("arg_app.num_levels_deep" + arg_app.num_levels_deep);
       arg_app.pause();
       rjs_app = arg_app;
       has_rjs_app = true;
      };//

      var myErrback = function(arg_app){
        console.log("errored back");
      };//

      //Path to app must be relative location from this HTML file:
      var rel_path = "app_rel_path/NexFracLoader";
      requirejs([rel_path], myCallback, myErrback);

      $scope.loaderToggle = function(){
        rjs_app.toggle();
      };//
    };//INIT
				//RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR//
					

				});//CONTROLLER::END
				</script>

 
    </body>
</html>