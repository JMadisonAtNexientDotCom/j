<!DOCTYPE html>

<!--
SOURCE URL: http://www.coding-dude.com/wp/web-design/create-dynamic-backgrounds-website-using-html5-canvas/
We cant use this. It flickers too much to animate. Might be useful later.
Maybe you can use green sock GSP to dynamically change canvas size?
-->

<html>
<head>
<script type="text/javascript">
//create the canvas element
var myCanvas = document.createElement("canvas");
var dom_bg = null;
var dom_style = null;
var somevar = "the var";
var buffer_flag = false;
var buffer_counter = 0;

function init(){
  setDocumentReference();
	onEnterFrame();
}//

function setDocumentReference(){
  dom_bg = document.body.style.background;
	dom_style = document.body.style;
	div01_style = document.getElementById("myDiv01").style;
	div02_style = document.getElementById("myDiv02").style;
}

function drawCanvas(){

  

	//set the canvas width and height
	myCanvas.width=100;
	myCanvas.height=100;

	//get the 2-dimensional drawing context
	var ctx = myCanvas.getContext("2d");
	//first we clear the canvas
	ctx.clearRect(0,0,100,100);
	//setup the palette array
	var grayPalette = ["#aaaaaa","#bbbbbb","#cccccc","#dddddd","#eeeeee"];

	//create 10x10 squares
	for (i=0;i<10;i++){
	 for(j=0;j<10;j++){
		//indicate when starting drawing a rectangle
		ctx.beginPath();
		ctx.rect(0+10*j,0+10*i,10,10);

		//choose a random color from the palette
		var randomColorIndex = 
			Math.round(Math.random() * (grayPalette.length-1));
		ctx.fillStyle = grayPalette[randomColorIndex];

		//fill the rectangle with the selected color
		ctx.fill();

		//draw a white border for the rectangle
		ctx.strokeStyle = "#ffffff";
		ctx.stroke();

		//indicating when finished drawing the rectangle
		ctx.closePath();
	 }
	}
}//FUNC::END
drawCanvas();

function onEnterFrame(){
  buffer_counter++;
	if(buffer_counter > 3){buffer_counter = 0;} //0,1,2,3

	if(buffer_counter != 1){
	  drawCanvas();
	}
	
	setDynamicBackground();
	
	this.setTimeout(onEnterFrame, 120);
}//

function makeNewBg(){
  drawCanvas();
	setDynamicBackground();
}//

//this will run when the document has finished loading
function setDynamicBackground(){
  //generate the image from the canvas
  var imageDataURL = myCanvas.toDataURL();

	//console.log(somevar);
	//console.log(buffer_flag);
  //set the dynamic image as the background
	
	//buffer_flag = (!buffer_flag);
	
	if(buffer_counter==0){
	div01_style.background =
	"transparent url('"+imageDataURL+"') repeat";
	
	  //div01_style.background = '#0000ff';
	  div02_style.background = 'transparent';
	}else
	if(buffer_counter==1 ||
	   buffer_counter==3){
	
	   //show BOTH to hide flicker transition hopefully.
		div02_style.background =
	  "transparent url('"+imageDataURL+"') repeat";
		
		div01_style.background =
	  "transparent url('"+imageDataURL+"') repeat";
	
	  
	}else
	if(buffer_counter==2){
	  //div02_style.background = '#0000ff';
		div02_style.background =
	  "transparent url('"+imageDataURL+"') repeat";
		
		div01_style.background = 'transparent';
	}
	
	//document.getElementById("myDiv").style.backgroundColor = '#00ff00';
	
  //dom_style.background = 
  // "transparent url('"+imageDataURL+"') repeat";
	 
	
}
</script>
</head>
<body onload="init()">

   <div id="myDiv01" 
	 style="width:220px; height:50px; z-index:1;
	 background:#ff00ff; position:absolute;">
	 </div>
	 
	 <div id="myDiv02" 
	 style="width:220px; height:50px; z-index:2;
	 background:transparent; position:absolute;">
	 </div>

</body>
</html>